(function(h){var j=function(e){return"undefined"===typeof h[e]?("undefined"!==typeof console&&console.log("Warning: 'hdr2d' canvas context not supported ("+e+" needed)"),!1):!0};if(j("HTMLCanvasElement")&&j("ArrayBuffer")&&j("Float32Array")){h.HDR2D_BLEND_SRC=0;h.HDR2D_BLEND_DST=1;h.HDR2D_BLEND_CLEAR=2;h.HDR2D_BLEND_XOR=3;h.HDR2D_BLEND_OVER=4;h.HDR2D_BLEND_IN=5;h.HDR2D_BLEND_OUT=6;h.HDR2D_BLEND_ATOP=7;h.HDR2D_BLEND_DST_OVER=8;h.HDR2D_BLEND_DST_IN=9;h.HDR2D_BLEND_DST_OUT=10;h.HDR2D_BLEND_DST_ATOP=
11;h.HDR2D_BLEND_ADD=12;h.HDR2D_BLEND_SUBTRACT=13;h.HDR2D_BLEND_MULTIPLY=14;h.HDR2D_BLEND_AVERAGE=15;h.HDR2D_BLEND_SCREEN=16;h.HDR2D_BLEND_SOFTLIGHT=17;h.HDR2D_BLEND_HARDLIGHT=18;h.HDR2D_BLEND_OVERLAY=19;j=document.createElement("canvas");j.width=1;j.height=1;var k=j.getContext("2d").getImageData(0,0,1,1),m=function(e,b){this.width=e;this.height=b;this.data=new Float32Array(new ArrayBuffer(16*e*b))},q=function(){var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0000ff",aquamarine:"7fffd4",azure:"f0ffff",
beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",
darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",
hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",
linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",
palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",
thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},b=function(a,b,d){0>d&&d++;1<d&&d--;return 1>6*d?a+6*(b-a)*d:1>2*d?b:2>3*d?a+6*(b-a)*(2/3-d):a};return function(a){a=a.replace(/^\s\s*/,"").replace(/\s*\s$/,"").toLowerCase();e.hasOwnProperty(a)&&(a="#"+e[a]);if("#"===a.charAt(0))return 4===a.length&&(a=["#",a.charAt(1),a.charAt(1),a.charAt(2),a.charAt(2),a.charAt(3),a.charAt(3)].join("")),{r:parseInt(a.substring(1,
3),16),g:parseInt(a.substring(3,5),16),b:parseInt(a.substring(5,7),16),a:255};var c=a.indexOf("("),d=a.indexOf(")",c),g=a.substring(0,c).replace(/\s/g,""),c=a.substring(c+1,d).split(","),a=3<c.length?255*parseFloat(c[3]):255;switch(g){case "rgb":case "rgba":return{r:parseFloat(c[0]),g:parseFloat(c[1]),b:parseFloat(c[2]),a:a};case "hsl":case "hsla":return g=parseFloat(c[0])/360,d=parseFloat(c[1])/100,c=parseFloat(c[2])/100,d=0.5>=c?c*(d+1):c+d-c*d,c=2*c-d,{r:255*b(c,d,g+1/3),g:255*b(c,d,g),b:255*b(c,
d,g-1/3),a:a}}return{r:0,g:0,b:0,a:0}}}(),i=function(e){this._context=e.getContext.apply(e,["2d"]);this._imageData=this._context.getImageData(0,0,e.width,e.height);this.imageData=new m(e.width,e.height);this.canvas=e};i.prototype.fillStyle="#000000";i.prototype.globalAlpha=1;i.prototype.globalBlendMode=HDR2D_BLEND_OVER;i.prototype.range={r:{low:0,high:255},g:{low:0,high:255},b:{low:0,high:255},a:{low:0,high:255}};i.prototype.getBlendFunction=function(){var e={};e[HDR2D_BLEND_SRC]={component:function(b,
a,c){return b*c},alpha:function(b){return b}};e[HDR2D_BLEND_DST]={component:function(b,a,c,d){return a*d},alpha:function(b,a){return a}};e[HDR2D_BLEND_CLEAR]={component:function(){return 0},alpha:function(){return 0}};e[HDR2D_BLEND_XOR]={component:function(b,a,c,d){return b*c*(1-d)+a*d*(1-c)},alpha:function(b,a){return b+a-2*b*a}};e[HDR2D_BLEND_OVER]={component:function(b,a,c,d){return b*c+a*d*(1-c)},alpha:function(b,a){return b+a-b*a}};e[HDR2D_BLEND_IN]={component:function(b,a,c,d){return b*c*d},
alpha:function(b,a){return b*a}};e[HDR2D_BLEND_OUT]={component:function(b,a,c,d){return b*c*(1-d)},alpha:function(b,a){return b*(1-a)}};e[HDR2D_BLEND_ATOP]={component:function(b,a,c,d){return b*c*d+a*d*(1-c)},alpha:function(b,a){return a}};e[HDR2D_BLEND_DST_OVER]={component:function(b,a,c,d){return a*d+b*c*(1-d)},alpha:function(b,a){return b+a-b*a}};e[HDR2D_BLEND_DST_IN]={component:function(b,a,c,d){return a*d*c},alpha:function(b,a){return b*a}};e[HDR2D_BLEND_DST_OUT]={component:function(b,a,c,d){return a*
d*(1-c)},alpha:function(b,a){return a*(1-b)}};e[HDR2D_BLEND_DST_ATOP]={component:function(b,a,c,d){return a*d*c+b*c*(1-d)},alpha:function(b){return b}};e[HDR2D_BLEND_ADD]={component:function(b,a,c,d){return a*d+b*c},alpha:e[HDR2D_BLEND_OVER].alpha};e[HDR2D_BLEND_SUBTRACT]={component:function(b,a,c,d){return a*d-b*c},alpha:e[HDR2D_BLEND_OVER].alpha};e[HDR2D_BLEND_MULTIPLY]={component:function(b,a,c,d){return b*a/255*c+a*d*(1-c)},alpha:e[HDR2D_BLEND_OVER].alpha};e[HDR2D_BLEND_AVERAGE]={component:function(b,
a,c,d){return(b+a)/2*c+a*d*(1-c)},alpha:e[HDR2D_BLEND_OVER].alpha};e[HDR2D_BLEND_SCREEN]={component:function(b,a,c,d){return(255-(Math.round((255-b)*(255-a))>>8))*c+a*d*(1-c)},alpha:e[HDR2D_BLEND_OVER].alpha};e[HDR2D_BLEND_OVERLAY]={component:function(b,a,c,d){return(128<b?2*a*b/255:255-2*(255-a)*(255-b)/255)*c+a*d*(1-c)},alpha:e[HDR2D_BLEND_OVER].alpha};e[HDR2D_BLEND_SOFTLIGHT]={component:function(b,a,c,d){return(128>a?2*((Math.round(b)>>1)+64)*(a/255):255-2*(255-((Math.round(b)>>1)+64))*(255-a)/
255)*c+a*d*(1-c)},alpha:e[HDR2D_BLEND_OVER].alpha};e[HDR2D_BLEND_HARDLIGHT]={component:function(b,a,c,d){return(128>b?2*a*b/255:255-2*(255-a)*(255-b)/255)*c+a*d*(1-c)},alpha:e[HDR2D_BLEND_OVER].alpha};return function(b){return e[b]}}();i.prototype.clearRect=function(e,b,a,c){for(var d=Math.max(0,Math.min(this.imageData.width,e)),g=Math.max(0,Math.min(this.imageData.height,b)),e=Math.max(0,Math.min(this.imageData.width,e+a)),f=Math.max(0,Math.min(this.imageData.height,b+c)),c=g;c<f;c++)for(a=d;a<e;a++)b=
4*(c*this.imageData.width+a),this.imageData.data[b]=0,this.imageData.data[b+1]=0,this.imageData.data[b+2]=0,this.imageData.data[b+3]=0;this.invalidate(d,g,e-d,f-g)};i.prototype.fillRect=function(e,b,a,c){"object"!==typeof this.fillStyle&&(this.fillStyle=q(this.fillStyle));for(var d=Math.max(0,Math.min(this.imageData.width,e)),g=Math.max(0,Math.min(this.imageData.height,b)),e=Math.max(0,Math.min(this.imageData.width,e+a)),f=Math.max(0,Math.min(this.imageData.height,b+c)),h=this.getBlendFunction(this.globalBlendMode),
c=g;c<f;c++)for(a=d;a<e;a++){var b=4*(c*this.imageData.width+a),i=this.imageData.data[b+3]/255,l=this.fillStyle.a*this.globalAlpha/255;this.imageData.data[b]=h.component(this.fillStyle.r,this.imageData.data[b],l,i);this.imageData.data[b+1]=h.component(this.fillStyle.g,this.imageData.data[b+1],l,i);this.imageData.data[b+2]=h.component(this.fillStyle.b,this.imageData.data[b+2],l,i);this.imageData.data[b+3]=255*h.alpha(l,i)}this.invalidate(d,g,e-d,f-g)};i.prototype.setPixel=function(e,b,a){var c=4*(Math.round(e)+
Math.round(b)*this.imageData.width),d=this.getBlendFunction(this.globalBlendMode);"undefined"===typeof a.a&&(a.a=255);var g=this.imageData.data[c+3]/255,f=a.a*this.globalAlpha/255;this.imageData.data[c]=d.component(a.r,this.imageData.data[c],f,g);this.imageData.data[c+1]=d.component(a.g,this.imageData.data[c+1],f,g);this.imageData.data[c+2]=d.component(a.b,this.imageData.data[c+2],f,g);this.imageData.data[c+3]=255*d.alpha(f,g);this._imageData.data[c]=k.data[0]=255*((this.imageData.data[c]-this.range.r.low)/
(this.range.r.high-this.range.r.low));this._imageData.data[c+1]=k.data[1]=255*((this.imageData.data[c+1]-this.range.g.low)/(this.range.g.high-this.range.g.low));this._imageData.data[c+2]=k.data[2]=255*((this.imageData.data[c+2]-this.range.b.low)/(this.range.b.high-this.range.b.low));this._imageData.data[c+3]=k.data[3]=255*((this.imageData.data[c+3]-this.range.a.low)/(this.range.a.high-this.range.a.low));this._context.putImageData(k,e,b,0,0,1,1)};i.prototype.getPixel=function(e,b){var a=4*(Math.round(e)+
Math.round(b)*this.imageData.width);return{r:this.imageData.data[a],g:this.imageData.data[a+1],b:this.imageData.data[a+2],a:this.imageData.data[a+3]}};i.prototype.getImageData=function(e,b,a,c){if(0===e&&0===b&&a===this.imageData.width&&c===this.imageData.height)return this.imageData;var d=Math.min(a,this.imageData.width-e),g=Math.min(c,this.imageData.height-b),c=e+d,a=b+g,d=new m(d,g),f,h,g=0;for(f=b;f<a;f++)for(b=e;b<c;b++)h=4*(f*this.imageData.width+b),d.data[g++]=this.imageData.data[h],d.data[g++]=
this.imageData.data[h+1],d.data[g++]=this.imageData.data[h+2],d.data[g++]=this.imageData.data[h+3];return d};i.prototype.drawImage=function(e,b,a,c,d){var g=arguments,f=e.width,h=e.height;5<arguments.length&&(f=g[3],h=g[4],b=g[5],a=g[6],c=g[7],d=g[8]);b=b||0;a=a||0;c=c||f;d=d||h;f=document.createElement("canvas");f.width=this.imageData.width;f.height=this.imageData.height;f=f.getContext("2d");f.globalAlpha=1;f.drawImage.apply(f,g);var i,l,j,g=this.getBlendFunction(this.globalBlendMode),k=f.getImageData(0,
0,this.imageData.width,this.imageData.height).data,m=Math.max(0,Math.floor(b)),n=Math.max(0,Math.floor(a)),o=Math.min(this.imageData.width,Math.ceil(b+c)),p=Math.min(this.imageData.height,Math.ceil(a+d));for(i=n;i<p;i++)for(h=m;h<o;h++)f=4*(i*this.imageData.width+h),j=this.imageData.data[f+3]/255,l=k[f+3]*this.globalAlpha/255,this.imageData.data[f]=g.component(k[f],this.imageData.data[f],l,j),this.imageData.data[f+1]=g.component(k[f+1],this.imageData.data[f+1],l,j),this.imageData.data[f+2]=g.component(k[f+
2],this.imageData.data[f+2],l,j),this.imageData.data[f+3]=255*g.alpha(l,j);this.invalidate(m,n,o-m,p-n)};i.prototype.invalidate=function(e,b,a,c){var d,g,f=[this.range.r,this.range.g,this.range.b,this.range.a];"undefined"===typeof e&&(e=0);"undefined"===typeof b&&(b=0);"undefined"===typeof a&&(a=this.imageData.width);"undefined"===typeof c&&(c=this.imageData.height);if(0===e&&0===b&&a===this.imageData.width&&c===this.imageData.height){b=0;for(e=this.imageData.data.length;b<e;b++)a=f[b%4],this._imageData.data[b]=
255*((this.imageData.data[b]-a.low)/(a.high-a.low))}else{a=Math.min(e+a,this.imageData.width);c=Math.min(b+c,this.imageData.height);for(g=b;g<c;g++)for(d=e;d<a;d++)b=4*(g*this.imageData.width+d),this._imageData.data[b]=255*((this.imageData.data[b]-f[0].low)/(f[0].high-f[0].low)),this._imageData.data[b+1]=255*((this.imageData.data[b+1]-f[1].low)/(f[1].high-f[1].low)),this._imageData.data[b+2]=255*((this.imageData.data[b+2]-f[2].low)/(f[2].high-f[2].low)),this._imageData.data[b+3]=255*((this.imageData.data[b+
3]-f[3].low)/(f[3].high-f[3].low))}this._context.putImageData(this._imageData,0,0)};h.ImageDataHDR=m;h.CanvasRenderingContextHDR2D=i;HTMLCanvasElement.prototype.getContext=function(){var e=HTMLCanvasElement.prototype.getContext;return function(){return"hdr2d"===arguments[0]?new i(this):e.apply(this,arguments)}}()}})(window);